# OpenAI API Setup Required for AI Insights

## ⚠️ IMPORTANT: AI Insights Require OpenAI API Key

As of the latest update, **all fallback/stub insights have been removed**. The AI Insights feature will **only work** with a properly configured OpenAI API key.

## Why This Change?

Previously, the system would generate fake "stub insights" when OpenAI wasn't configured or when API calls failed. This was misleading and unprofessional, showing fake data as if it were real AI analysis.

**Now:**
- ✅ Real AI insights generated by GPT-4o-mini
- ❌ No fallback fake insights
- ❌ No stub data when API fails
- ✅ Clear error messages when configuration is missing

## Setup Instructions

### 1. Get an OpenAI API Key

1. Go to https://platform.openai.com/api-keys
2. Sign up or log in to your OpenAI account
3. Click "Create new secret key"
4. Copy the key (it starts with `sk-...`)
5. **Important:** Save it securely - you won't be able to see it again

### 2. Add to Local Development (.env.local)

```bash
# Add this to your .env.local file
OPENAI_API_KEY=sk-your-actual-api-key-here
```

### 3. Add to Production Deployment

#### For Vercel:
1. Go to your project dashboard
2. Settings → Environment Variables
3. Add:
   - **Name:** `OPENAI_API_KEY`
   - **Value:** `sk-your-actual-api-key-here`
   - **Environments:** All (Production, Preview, Development)
4. Redeploy your application

#### For Whop Apps:
1. Go to your Whop app settings
2. Navigate to environment variables
3. Add:
   - **Key:** `OPENAI_API_KEY`
   - **Value:** `sk-your-actual-api-key-here`
4. Save and redeploy

## Cost Estimation

The AI Insights feature uses the `gpt-4o-mini` model, which is very cost-effective:

- **Model:** gpt-4o-mini
- **Pricing:** ~$0.15 per million input tokens, ~$0.60 per million output tokens
- **Typical insight generation:** 500-1500 tokens (~$0.0005 - $0.002 per generation)
- **Estimated monthly cost:** $1-5 for 1,000-5,000 insight generations

### Cost Control

The system is designed to be cost-efficient:
- Only analyzes data when explicitly requested (Generate Insights button)
- Uses token limits (max 1500 tokens per response)
- Processes only relevant data (last 100 form submissions)
- PII scrubbing reduces unnecessary token usage

## What Happens Without OpenAI API Key?

**When the API key is missing:**
```
Error: OpenAI API key is required for AI insights generation. 
Please configure OPENAI_API_KEY in your environment variables.
```

**When there's no student data:**
```
Error: No student feedback data available. 
Please collect survey responses before generating insights.
```

**When the API call fails:**
The actual OpenAI error will be shown (e.g., rate limit, invalid key, network error)

## Testing the Setup

After adding your API key:

1. Restart your development server (if local):
   ```bash
   npm run dev
   ```

2. Navigate to the AI Insights page
3. Click "Generate Insights"
4. You should see:
   - ✅ Loading state with spinner
   - ✅ Console logs showing OpenAI API call
   - ✅ Real AI-generated insights displayed
   - ✅ Insights stored in database with `ai_generated: true`

## Troubleshooting

### "OpenAI API key is required"
- Check that `OPENAI_API_KEY` is set in your environment
- Verify the key starts with `sk-`
- Restart your server/redeploy after adding the key

### "Insufficient quota"
- Your OpenAI account needs to have available credits
- Add a payment method at https://platform.openai.com/account/billing
- Check your usage limits

### "Invalid API key"
- Verify you copied the entire key (starts with `sk-`)
- Make sure there are no extra spaces or quotes
- Try generating a new API key

### "Rate limit exceeded"
- OpenAI has rate limits on API calls
- Wait a few seconds and try again
- Consider upgrading your OpenAI plan if hitting limits frequently

## Security Best Practices

### ✅ DO:
- Store API keys in environment variables only
- Use `.env.local` for local development (never commit this file)
- Add `.env.local` to `.gitignore`
- Rotate API keys regularly
- Monitor usage on OpenAI dashboard

### ❌ DON'T:
- Commit API keys to Git
- Share API keys publicly
- Hardcode API keys in source code
- Use the same key for multiple environments

## Monitoring Usage

Track your OpenAI API usage:
1. Visit https://platform.openai.com/usage
2. View daily/monthly token usage
3. Set up usage alerts
4. Monitor costs

## Alternative: Self-Hosted AI Models

If you prefer not to use OpenAI's API, you could modify the code to use:
- Local LLaMA models
- Ollama
- Other AI providers (Anthropic Claude, Google Gemini, etc.)

However, this requires significant code changes and is not currently supported.

## Support

If you encounter issues with OpenAI setup:
1. Check the OpenAI status page: https://status.openai.com/
2. Review OpenAI documentation: https://platform.openai.com/docs
3. Check your console logs for detailed error messages
4. Verify your API key is valid and has credits

---

**Last Updated:** October 23, 2025
**Related Files:**
- `lib/utils/aiInsights.ts` - Main AI insights generation
- `lib/utils/aiProcessing.ts` - Enhanced AI processing
- `lib/ai/openai-client.ts` - OpenAI client configuration

